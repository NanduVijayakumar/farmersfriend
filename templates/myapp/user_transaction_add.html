{% extends 'myapp/user_base.html' %}
{% load static %}
{% block title %}Ask {% endblock %}
{% block body %}
<center>
    <h1>Purchase</h1><hr><hr>
     <div class="container">
    <form id="rzp-form"  name="frm" action="{% url 'user_transaction_add'%}" method="post">
        {% csrf_token %}
        	<input  type="hidden"  id="product_id" name="product_id" value={{product.id}} required>
            <input  type="hidden"  id="status" name="status" value="" required>
        <div class="form-group">
            <h3>Name : {{ product.p_name }}</h3>
        </div>
        <div class="form-group">
<!--            <label for="amt">Amount :</label>-->
            <h3>Amount : Rs.{{product.price}}</h3>
            <input  type="hidden"   name="amt" value={{product.price}} >
        </div>
          <div class="form-group">
            <label for="addr">Address :</label>
            <textarea class="form-control"  rows="4" id="addr" name="addr" required> </textarea>
        </div>
<!--        <div class="form-group">-->
<!--            <label for="card_no">card_no :</label>-->
<!--            <input class="form-control" type="text"  id="card_no" name="card_no" value='' required="required">-->
<!--        </div>-->
<!--        <div class="form-group">-->
<!--            <label for="cvv">cvv :</label>-->
<!--            <input class="form-control" type="text"  id="cvv" name="cvv" value='' required="required">-->
<!--        </div>-->
<!--<div class="form-group">&ndash;&gt;-->
<!--<label for="expiry">expiry :</label>&ndash;&gt;-->
<!--            <input class="form-control" type="date"  id="expiry" name="expiry" value='' required="required">-->
<!--        </div>-->
<!--        <button type="reset" class="btn btn-info" id="rt" name="rt">Clear</button>-->


<!--<script-->
<!--    src="https://checkout.razorpay.com/v1/checkout.js"-->
<!--    data-key="{{key}}" // Enter the Test API Key ID generated from Dashboard → Settings → API Keys-->
<!--    data-amount="{{amt}}" // Amount is in currency subunits. Hence, 29935 refers to 29935 paise or ₹299.35.-->
<!--    data-currency="INR"// You can accept international payments by changing the currency code. Contact our Support Team to enable International for your account-->
<!--    data-order_id="{{payment.id}}"// Replace with the order_id generated by you in the backend.-->
<!--    data-buttontext=""-->
<!--    data-name="Farmers Friend"-->
<!--    data-description="{{ product.p_name }}"-->
<!--    data-prefill.name="Nandu P V"-->
<!--    data-theme.color="#F37254"-->
<!--&gt;</script>-->




<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
<script>
var formData = document.getElementById('rzp-form');
var statusData = document.getElementById('status');
var options = {
    "key": "{{key}}", // Enter the Key ID generated from the Dashboard
    "amount": "{{amt}}", // Amount is in currency subunits. Default currency is INR. Hence, 50000 refers to 50000 paise
    "currency": "INR",
    "name": "Farmers Friend",
    "description": "{{ product.p_name }}",
    "image": "",
    "order_id": "{{order_id}}", //This is a sample Order ID. Pass the `id` obtained in the response of Step 1
    "handler": function (response){
    console.log(response)
            alert("Payment Success")
            statusData.value="Payment Success"
            formData.submit();
<!--        alert(response.razorpay_payment_id);-->
<!--        alert(response.razorpay_order_id);-->
<!--        alert(response.razorpay_signature)-->
    },
    "prefill": {
        "name": "Gaurav Kumar",
        "email": "gaurav.kumar@example.com",
        "contact": "9999999999"
    },
    "notes": {
        "address": "Razorpay Corporate Office"
    },
    "theme": {
        "color": "#3399cc"
    }
};
var rzp1 = new Razorpay(options);

rzp1.on('payment.failed', function (response){

          alert( response.error.description);
        statusData.value=response.error.description;
        formData.submit();
<!--        alert( response.error.description);-->
<!--        alert( response.error.source);-->
<!--        alert( response.error.step);-->
<!--        alert( response.error.reason);-->
<!--        alertresponse.error.metadata.order_id);-->
<!--        alert( response.error.metadata.payment_id);-->
});
 function submitHandler() {
    rzp1.open();
}
</script>


    </form>
                <button class="btn btn-info" onclick="submitHandler()" >Purchase</button>

     </div>
    <h3>{{msg}}</h3>
</center>
{% endblock %}
